@using Tridion.ContentDelivery.AmbientData
@using Tridion.ContentDelivery.AmbientData.Runtime
@model PageModel

@{
    var mymodel = Model;
    bool isNew = false;
    var query = Request.QueryString["utm_term"];
    var source = Request.QueryString["utm_source"];
		var campaignValue = Request.QueryString["utm_campaign"];
    if(!string.IsNullOrEmpty(source) && !source.Contains(".com") && !source.Contains("email"))
    {
        source +=  ".com";
    }
		 if (!string.IsNullOrEmpty(campaignValue))
    {
        AmbientDataContext.CurrentClaimStore.Put(new Uri("taf:claim:visitor:segment"), campaignValue , ClaimValueScope.Session);
        this.Response.Redirect(HttpContext.Current.Request.Url.AbsolutePath, false);
    }
	
    if(!string.IsNullOrEmpty(query)){
        AmbientDataContext.CurrentClaimStore.Put(new Uri("taf:claim:visitor:searchquery"), query.Replace("?",""), ClaimValueScope.Session);
        AmbientDataContext.CurrentClaimStore.Put(new Uri("taf:claim:visitor:leadscore"), "10", ClaimValueScope.Session);
        if(query.ToLower().Contains("polycrystalline"))
        {
            if(query.ToLower().Contains("commercial"))
            {
                Uri uri = new Uri("taf:claim:visitor:segment");

                if (!AmbientDataContext.CurrentClaimStore.Contains(uri))
                {
                    isNew = true;
                }
                AmbientDataContext.CurrentClaimStore.Put(new Uri("taf:claim:visitor:segment"), "Commercial", ClaimValueScope.Session);
            }else
            {
                AmbientDataContext.CurrentClaimStore.Put(new Uri("taf:claim:visitor:segment"), "Polycrystalline", ClaimValueScope.Session);
            }
        }
    }
    if(!string.IsNullOrEmpty(source)){
        Uri uri = new Uri("taf:claim:visitor:referrer");

        if (!AmbientDataContext.CurrentClaimStore.Contains(uri))
        {
            isNew = true;
        }
        AmbientDataContext.CurrentClaimStore.Put(new Uri("taf:claim:visitor:referrer"), source, ClaimValueScope.Session);
    }
    if (isNew) {
        this.Response.Redirect(HttpContext.Current.Request.Url.PathAndQuery, false);
    }
}
<link href="/content/insurance/css/insuranceWidget/main.c8cacd76.chunk.css" rel="stylesheet" /> 
<!-- Header Section -->
@Html.DxaRegion("Header")

<div id="Searchroot"></div>

<div class="pageroot">
<!-- Home Banner -->
@Html.DxaRegion("Banner")

<!-- React SPA Insurance widget -->

@{
	    string reqUrl = "";
        reqUrl = Request.Url.AbsolutePath.ToString();  

        if (reqUrl == "/ai" || reqUrl == "/ai/index.html" || reqUrl == "/ai/index")
        { 
            <div id = "insuranceWidget"></div>
			<script src="/content/insurance/js/insuranceWidget/2.de43f497.chunk.js"></script>
			<script src="/content/insurance/js/insuranceWidget/3.33164081.chunk.js"></script>
			<script src="/content/insurance/js/insuranceWidget/main.a1f59a45.chunk.js"></script>
			<script src="/content/insurance/js/insuranceWidget/runtime-main.4e09eca9.js"></script>
        }
} 

@Html.DxaRegion("Product Region")
@Html.DxaRegion("Campaign Region")
@Html.DxaRegion("News Room Region")
@*@Html.DxaRegion("FindAnInstaller")*@
</div>

<!-- Our Offerings Section -->
<!-- Savings and Subsidies Section -->
<!-- Newsroom Section -->
<!-- chat section -->
<section id="chat" class="chat-panel">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12 p-0">
                <div class="position-fixed chat-btn-position">
                    <!-- Chat icon -->
                    <div class="chat-btn">
                        <button type="button" class="btn btn-primary rounded-circle">
                            <i class="material-icons md-125 m-2">chat_bubble</i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-md-3 p-0 position-fixed bg-white chat-box">
                <div class="messaging">
                    <div class="inbox_msg">
                        <div class="chat-header tex-white text-left px-3 py-2 border-top-left">
                            <h6><span>SOLAR</span><span>Panels</span></h6>
                            <p>Typically replies in a day</p>
                        </div>
                        <div class="container-fluid">
                            <div class="row">
                                <div class="chat-body p-2">
                                    <div class="w-auto float-left clearfix incoming-chat p-1 animated fadeIn" id="chat1">
                                        <div class="col-md-auto p-1">
                                            <div class="chat-msg">
                                                <p class="m-0 p-3">Welcome to the agent chat.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="w-auto float-right clearfix outgoing-chat p-1 fadeIn animated" id="chat2">
                                        <div class="col-md-auto p-1">
                                            <div class="chat-msg">
                                                <p class="m-0 p-3">Est-ce les panneaux sont  disponibles en France? </p>
                                            </div>
                                        </div>
                                        <div class="chat-translation pl-3 animated fadeIn" id="chat3">
                                            <p class="m-0">English translation:</p>
                                            <p class="m-0 translated-text">Are the panels available in France? </p>
                                        </div>
                                    </div>
                                    <div class="w-auto float-left clearfix incoming-chat p-1 fadeIn animated" id="chat4">
                                        <div class="col-md-auto p-1">
                                            <div class="chat-msg">
                                                <p class="m-0 p-3">Yes we do ship the panels to France or you can find them at Solutions Solaire </p>
                                            </div>
                                        </div>
                                        <div class="chat-translation pl-3 animated fadeIn" id="chat5">
                                            <p class="m-0">French Response:</p>
                                            <p class="m-0 translated-text">Oui oui on peut expédier les panneaux en france. Ils sont également disponibles chez Solutions Solaires. </p>
                                        </div>
                                    </div>
                                    <div class="w-auto float-right clearfix outgoing-chat p-1 fadeIn animated" id="chat6">
                                        <div class="col-md-auto p-1">
                                            <div class="chat-msg">
                                                <p class="m-0 p-3">Merci! </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="input-group border-top position-absolute chat-input">
                                    <input type="text" class="form-control border-0" id="inlineFormInputGroup" placeholder="@Html.Resource("core.SendMessage")...">
                                    <div class="input-group-apend border-0 d-flex align-content-center">
                                        <div class="input-group-text bg-white border-0">
                                            <i class="gif material-icons md-175 mx-1">gif</i>
                                            <i class="faces material-icons md-175 mx-1">sentiment_satisfied_alt</i>
                                            <i class="attach material-icons md-175 mx-1">attachment</i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Footer section -->
@Html.DxaRegion("Footer")
	
